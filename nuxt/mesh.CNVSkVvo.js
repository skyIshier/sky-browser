import{n as x,q as Q,r as q,L as Z,N as ee,u as E,o as B,c as D,a as P,F as te,s as re,O as ae,t as ne,_ as J,S as oe,Q as Y,W as se,R as M,U as ie,V as ce,X as V,Y as U,Z as le,$ as W,I as _e,h as me,a0 as pe,a1 as de,a2 as he,J as C,K as ue,a3 as ge,H as Re,v as j,b as Ee,w as ye}from"./entry.BgnvDUI5.js";import{o as X}from"./index.ely8kfid.js";import{u as H,p as we,c as fe,a as be}from"./ui-store.Cdca3RGT.js";import{_ as Se}from"./client-only.StvJ0LT5.js";import{u as Be}from"./apk-store.RSVZAT-b.js";import"./DataView.bL8bw3ed.js";import"./index._BGoy-tc.js";const Le={class:"sidebar"},ke={class:"mesh-list scroll-x rtl"},ve={class:"scroll-y ltr"},Ie=["id","onClick"],Ge=x({__name:"mesh-list",emits:["update:modelValue"],setup(S,{emit:d}){const p=H(),m=Q(()=>p.meshes.map(u=>u.filename)),g=q(!0);return X("ArrowDown",async u=>{var a;if(u.preventDefault(),!m.value)return;const c=m.value.findIndex(h=>h===p.meshName);c<0||c>=m.value.length-1||(p.selectMesh(m.value[c+1]),(a=document.getElementById(`mesh-${c+1}`))==null||a.scrollIntoView({block:"center"}))}),X("ArrowUp",async u=>{var a;if(u.preventDefault(),!m.value)return;const c=m.value.findIndex(h=>h===p.meshName);c<1||c>=m.value.length||(p.selectMesh(m.value[c-1]),(a=document.getElementById(`mesh-${c-1}`))==null||a.scrollIntoView({block:"center"}))}),(u,c)=>Z((B(),D("div",Le,[P("div",ke,[P("div",ve,[(B(!0),D(te,null,re(E(m),(a,h)=>{var y;return B(),D("div",{key:a,id:`mesh-${h}`,onClick:()=>E(p).selectMesh(a),class:ae({active:a===E(p).meshName})},ne((y=a.split("/").pop())==null?void 0:y.split(".mesh").shift()),11,Ie)}),128))])])],512)),[[ee,E(g)]])}}),Me=J(Ge,[["__scopeId","data-v-8cf57762"]]);function Ae(){const S=new oe,d=new Y("white",1);d.position.set(-2,20,-5),S.add(d);const p=new Y("#FDA",.1);p.position.set(2,-20,5),S.add(p);const m=new se(256);m.texture.type=M;const g=new ie(1,1e3,m);return{scene:S,cubeCamera:g,cubeRenderTarget:m}}class Fe extends ce{constructor(d){super(d),this.type=M}parse(d){const a=function(e,n){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(n||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(n||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(n||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(n||""))}return-1},R=`
`,L=function(e,n,l){n=n||1024;let i=e.pos,o=-1,t=0,_="",r=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(o=r.indexOf(R))&&t<n&&i<e.byteLength;)_+=r,t+=r.length,i+=128,r+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<o?(l!==!1&&(e.pos+=t+o+1),_+r.slice(0,o)):!1},N=function(e){const n=/^#\?(\S+)/,l=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,t={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let _,r;if(e.pos>=e.byteLength||!(_=L(e)))return a(1,"no header found");if(!(r=_.match(n)))return a(3,"bad initial token");for(t.valid|=1,t.programtype=r[1],t.string+=_+`
`;_=L(e),_!==!1;){if(t.string+=_+`
`,_.charAt(0)==="#"){t.comments+=_+`
`;continue}if((r=_.match(l))&&(t.gamma=parseFloat(r[1])),(r=_.match(s))&&(t.exposure=parseFloat(r[1])),(r=_.match(i))&&(t.valid|=2,t.format=r[1]),(r=_.match(o))&&(t.valid|=4,t.height=parseInt(r[1],10),t.width=parseInt(r[2],10)),t.valid&2&&t.valid&4)break}return t.valid&2?t.valid&4?t:a(3,"missing image size specifier"):a(3,"missing format specifier")},A=function(e,n,l){const s=n;if(s<8||s>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);if(s!==(e[2]<<8|e[3]))return a(3,"wrong scanline width");const i=new Uint8Array(4*n*l);if(!i.length)return a(4,"unable to allocate buffer space");let o=0,t=0;const _=4*s,r=new Uint8Array(4),v=new Uint8Array(_);let $=l;for(;$>0&&t<e.byteLength;){if(t+4>e.byteLength)return a(1);if(r[0]=e[t++],r[1]=e[t++],r[2]=e[t++],r[3]=e[t++],r[0]!=2||r[1]!=2||(r[2]<<8|r[3])!=s)return a(3,"bad rgbe scanline format");let G=0,w;for(;G<_&&t<e.byteLength;){w=e[t++];const f=w>128;if(f&&(w-=128),w===0||G+w>_)return a(3,"bad scanline data");if(f){const b=e[t++];for(let z=0;z<w;z++)v[G++]=b}else v.set(e.subarray(t,t+w),G),G+=w,t+=w}const O=s;for(let f=0;f<O;f++){let b=0;i[o]=v[f+b],b+=s,i[o+1]=v[f+b],b+=s,i[o+2]=v[f+b],b+=s,i[o+3]=v[f+b],o+=4}$--}return i},F=function(e,n,l,s){const i=e[n+3],o=Math.pow(2,i-128)/255;l[s+0]=e[n+0]*o,l[s+1]=e[n+1]*o,l[s+2]=e[n+2]*o,l[s+3]=1},K=function(e,n,l,s){const i=e[n+3],o=Math.pow(2,i-128)/255;l[s+0]=U.toHalfFloat(Math.min(e[n+0]*o,65504)),l[s+1]=U.toHalfFloat(Math.min(e[n+1]*o,65504)),l[s+2]=U.toHalfFloat(Math.min(e[n+2]*o,65504)),l[s+3]=U.toHalfFloat(1)},T=new Uint8Array(d);T.pos=0;const k=N(T);if(k!==-1){const e=k.width,n=k.height,l=A(T.subarray(T.pos),e,n);if(l!==-1){let s,i,o;switch(this.type){case V:o=l.length/4;const t=new Float32Array(o*4);for(let r=0;r<o;r++)F(l,r*4,t,r*4);s=t,i=V;break;case M:o=l.length/4;const _=new Uint16Array(o*4);for(let r=0;r<o;r++)K(l,r*4,_,r*4);s=_,i=M;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:n,data:s,header:k.string,gamma:k.gamma,exposure:k.exposure,type:i}}}return null}setDataType(d){return this.type=d,this}load(d,p,m,g){function u(c,a){switch(c.type){case V:case M:c.colorSpace=le,c.minFilter=W,c.magFilter=W,c.generateMipmaps=!1,c.flipY=!0;break}p&&p(c,a)}return super.load(d,u,m,g)}}const Te=x({__name:"mesh-viewer",setup(S){const d=ge(),p=q(),m=H(),{scene:g,cubeCamera:u,cubeRenderTarget:c}=Ae(),a=new _e;return g.add(a),me(()=>m.mesh,async()=>{try{const h=Re(m.mesh);if(!h)return;const{header:y,skyMesh:I}=we(h);console.log({header:y,skyMesh:I});const R=await fe(I);if(!R)return;R.geometry.computeBoundingSphere();const{center:L,radius:N}=R.geometry.boundingSphere;R.geometry.translate(-L.x,-L.y,-L.z),R.scale.divideScalar(N/5),a.clear(),a.add(R);const{renderer:A,render:F}=p.value??{};if(!A||!F)return;u.update(A,g),F()}catch(h){console.error(h)}},{immediate:!0}),pe(()=>{const{orbit:h,render:y,renderer:I}=p.value;h.object.position.set(-6,10,-10),h.target.set(0,0,0),h.update(),y(),I.toneMapping=de,console.log("baseURL:",d.app.baseURL),new Fe().setPath(d.app.baseURL).load("kloofendal_48d_partly_cloudy_puresky_1k.hdr",function(R){R.mapping=he,g.background=R,g.environment=R,y()})}),(h,y)=>(B(),C(E(ue),{ref_key:"perspective",ref:p,scene:E(g)},null,8,["scene"]))}}),Ue={class:"app"},De=x({__name:"mesh",setup(S){const d=H(),p=be(),m=Be();return(g,u)=>{const c=Me,a=Te,h=Se;return B(),D("div",Ue,[E(d).meshes.length&&E(p).showSidebar?(B(),C(c,{key:0,modelValue:E(d).meshName,"onUpdate:modelValue":u[0]||(u[0]=y=>E(d).meshName=y)},null,8,["modelValue"])):j("",!0),Ee(h,null,{default:ye(()=>[E(m).apk?(B(),C(a,{key:0,mesh:E(d).meshName},null,8,["mesh"])):j("",!0)]),_:1})])}}}),Pe=J(De,[["__scopeId","data-v-35beae5d"]]);export{Pe as default};
