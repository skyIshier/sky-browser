import{ba as h,aZ as l,h as c,E as m,M as u,G as p,y as F}from"./entry.BgnvDUI5.js";import{a as U}from"./index.ely8kfid.js";import{u as f}from"./apk-store.RSVZAT-b.js";import{g,l as y,u as k}from"./DataView.bL8bw3ed.js";const D=h("meshStore",()=>{const e=f(),a=U("sky-mesh-name","assets/Data/Meshes/Bin/AP13DuskGate_01.mesh"),t=l(),n=l([]);c(e,()=>{console.log("[watch] apk");const o=[];for(const i of e.files){if(!i.endsWith(".mesh")||!i.split("/").pop())continue;const r=e.apk[i];r&&o.push(r)}console.log("meshes:",o.length),n.value=o,o.length>0&&s(a.value)});async function s(o){console.log("select mesh:",o);const i=o.endsWith(".mesh")?o:o.concat(".mesh"),d=e.apk[i];if(d===void 0){console.warn(`No mesh for name: ${i}!`);return}try{t.value=await d.getDataView(),a.value=i}catch(r){console.error(r)}}return{meshes:n,meshName:a,mesh:t,selectMesh:s}});function b(e,a=0){return{view:e,get offset(){return a},set offset(t){a=t},skip:t=>a+=t,readUint32(t=!0){const n=e.getUint32(a,t);return a+=4,n},readFloat32(t=!0){const n=e.getFloat32(a,t);return a+=4,n},readUint16(t=!0){const n=e.getUint16(a,t);return a+=2,n},readFloat16(t=!0){const n=g(e,a,t);return a+=2,n},readUint8(){const t=e.getUint8(a);return a+=1,t},slice(t,n){const s=e.buffer.slice(t,n);return a+=n-t,s}}}function P(e){const a=v(e),t=x(e,a),n=S(t,a.version);return{header:a,skyMesh:n}}function v(e){return{version:e.getUint8(0),uncompressedSize:e.getUint32(82,!0),compressedSize:e.getUint32(78,!0),numLods:e.getUint32(68,!0)}}function x(e,a){const t=new Uint8Array(e.buffer.slice(86,86+a.compressedSize)),n=new Uint8Array(a.uncompressedSize);return y.decompressBlock(t,n,0,a.compressedSize,0),new DataView(n.buffer)}function M(e,a=31){return{inf:e.readFloat32(),bboxOld:{x0:e.readFloat32(),y0:e.readFloat32(),z0:e.readFloat32(),x1:e.readFloat32(),y2:e.readFloat32(),z3:e.readFloat32()},bbox:{x0:e.readFloat32(),y0:e.readFloat32(),z0:e.readFloat32(),x1:e.readFloat32(),y2:e.readFloat32(),z3:e.readFloat32()},padding:{p01:e.readFloat32(),p02:e.readFloat32(),p03:e.readFloat32(),p04:e.readFloat32(),p05:e.readFloat32(),p06:e.readFloat32(),p07:e.readFloat32(),p08:e.readFloat32(),p09:e.readFloat32(),p10:e.readFloat32(),p11:e.readFloat32(),p12:e.readFloat32(),p13:e.readFloat32(),p14:e.readFloat32(),p15:e.readFloat32(),p16:e.readFloat32()},vertexCount:e.readUint32(),cornerCount:e.readUint32(),isIdx32:e.readUint32(),numPoints:e.readUint32(),prop11:e.readUint32(),prop12:e.readUint32(),prop13:e.readUint32(),prop14:e.readUint32(),loadMeshNorms:e.readUint8(),loadInfo2:e.readUint8(),loadInfo3:e.readUint8(),skipMeshPos:e.readUint32(),skipUvs:e.readUint32(),flag3:e.readUint32(),unk1:e.readUint32(),unk2:e.readUint32(),unk3:e.readUint32(),unk4:e.readUint32()}}function S(e,a=31){const t={},n=b(e),s=M(n,a),{vertexCount:o,cornerCount:i}=s;return s.skipMeshPos===0&&(t.vertices=w(n,o)),s.loadMeshNorms>0&&(t.normals=B(n,o)),s.skipUvs===0&&(t.uv=A(n,o)),t.index=z(n,i),t.flags=s,t}function w(e,a){const t=[];for(let n=0;n<a;n++){const s=e.readFloat32(),o=e.readFloat32(),i=e.readFloat32();t.push(s,o,i),e.skip(4)}return t}function z(e,a){const t=[];for(let n=0;n<a;n++)t.push(e.readUint16());return t}function B(e,a){const t=[];for(let n=0;n<a;n++){const s=e.readUint8()/256,o=e.readUint8()/256,i=e.readUint8()/256;e.readUint8()/256,t.push(s,o,i)}return t}function A(e,a){const t=[];for(let n=0;n<a;n++)t.push(e.readFloat16(),1-e.readFloat16()),e.skip(12);return t}async function G(e,a){const t=new m,n={roughness:.2,metalness:1,color:"white"},s=new u(n);return t.setIndex(e.index),t.setAttribute("uv",new p(e.uv,2)),t.setAttribute("position",new p(e.vertices,3)),t.computeVertexNormals(),new F(t,s)}const L=h("uiStore",()=>({showSidebar:k("sidebarShowList",()=>!0)}));export{L as a,G as c,P as p,D as u};
